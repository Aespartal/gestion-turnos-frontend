<div class="container mt-5">
  <!-- Mensaje de éxito -->
  @if (mensajeExito()) {
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <i class="bi bi-check-circle-fill me-2"></i>
      <strong>{{ mensajeExito() }}</strong>
    </div>
  }

  <!-- Formulario de nueva cita -->
  <app-formulario-cita
    (citaCreada)="onCitaCreada($event)"
    [class.opacity-50]="guardando()">
  </app-formulario-cita>

  <!-- Lista de citas -->
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h2 class="mb-0">
        <i class="bi bi-calendar-check"></i> Gestión de Turnos
      </h2>
    </div>
    <div class="card-body">
      <!-- Estado de carga -->
      @if (loading()) {
        <div class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
          <p class="mt-3 text-muted">Cargando citas...</p>
        </div>
      }

      <!-- Mensaje de error -->
      @if (error() && !loading()) {
        <div class="alert alert-danger d-flex align-items-center" role="alert">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          <div>
            <strong>Error:</strong> {{ error() }}
            <button class="btn btn-sm btn-outline-danger ms-3" (click)="cargarCitas()">
              Reintentar
            </button>
          </div>
        </div>
      }

      <!-- Tabla de citas -->
      @if (!loading() && !error()) {
        <div class="mb-3 d-flex justify-content-between align-items-center">
          <span class="badge bg-secondary">
            Total de citas: {{ citas().length }}
          </span>
          <button class="btn btn-success btn-sm" (click)="cargarCitas()">
            <i class="bi bi-arrow-clockwise"></i> Actualizar
          </button>
        </div>

        <div class="table-responsive">
          <table class="table table-hover table-striped align-middle">
            <thead class="table-light">
              <tr>
                <th scope="col"><i class="bi bi-person"></i> Cliente</th>
                <th scope="col"><i class="bi bi-scissors"></i> Servicio</th>
                <th scope="col"><i class="bi bi-clock"></i> Fecha y Hora</th>
              </tr>
            </thead>
            <tbody>
              @for (cita of citas(); track cita.id) {
                <tr>
                  <td>{{ cita.clienteNombre }}</td>
                  <td>
                    <span class="badge bg-info text-dark">{{ cita.servicio }}</span>
                  </td>
                  <td>{{ cita.fechaHora | date:'dd/MM/yyyy HH:mm' }}</td>
                </tr>
              } @empty {
                <tr>
                  <td colspan="3" class="text-center text-muted py-4">
                    <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                    No hay citas registradas
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    </div>
  </div>
</div>
